---
title: "ChatGPT demo"
author: "Jon Wheeler"
date: "2023-11-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

An introductory workflow to demonstrate use cases for developing R code with ChatGPT or other large language models.

In this introduction, we will use the ChatGPT web interface to develop a workflow for analyzing the occurrence of baby names in the United States. Since ChatGPT will handle a lot of the syntax and code generation, we will focus on the following aspects of development:

- Problem decomposition
- Debugging
- Explaining code
- Improving performance

We note that this is the dataset we have used for the previous two R/RStudio workshops, in which we coded everything by hand. Let's see how our progress in those two workshops compares with ChatGPT! But first, as with any use of AI tools, we need to be aware of ethical considerations as we proceed.

- **Intellectual property and copyright:** The model is developed using source code published throughout the web. Some of the code generated by ChatGPT will be very generic and represent common usage. In other cases, the code may align with or map to someone's original intellectual property (imagine a highly specialized algorithm, class, or function). Keep in mind as well that AI generated works cannot be copyrighted.
- **Security:** Part of evaluating the code returned by ChatGPT includes assessing it for security flaws or other risks. Consider asking ChatGPT for an Apache server configuration file - would you really want to use it without verifying that the server would be secure? Also, is generated code safe for specific use cases - engineering staircases? Operating medical devices? Launching satellites?
- **Quality assurance:** Large language models 'hallucinate.' If ChatGPT isn't able to fully respond to a prompt, it will make up the difference. There may be cases where the code returns errors, refers to deprecated libraries, or for other reasons just won't work.
- **Bias:** Models are trained on content from across the web. The biases inherent in our systems can carry over into the responses from ChatGPT and other services (see for example <https://www.npr.org/sections/goatsandsoda/2023/10/06/1201840678/ai-was-asked-to-create-images-of-black-african-docs-treating-white-kids-howd-it->).

## Decomposition

Following recommendations and leading practices for using AI to generate code, we want our prompts to be specific to the desired results. Because of this, we can't really use a single, complex, multi-step prompt to generate an entire workflow. Instead, we need to think about the discrete steps in the process - we need to decompose the process - and write prompts that specify the context of the problem as well as the desired output or outcome.

Let's say we want to find out the most popular girl and boy names for the year 2010. The data are available from the following URL

~~~
https://raw.githubusercontent.com/unmrds/cc-R-RStudio/master/cc-R-Names/data/2010
~~~

The steps in our process are

1. Download the data
1. Convert the data to a Pandas dataframe
1. Group the data by sex
1. Sort the data by count of babies with each name
1. Get the top result for both girls and boys
1. As a bonus, we will plot the top 3 most popular names for each sex

Some of these steps will require multiple prompts. 

### Download the data

It is recommended to use comments or docstrings when engineering code prompts. Note the use of the ```library()``` function in the prompt. This helps ChatGPT know which language to use in the response. Without it, you might get some perfectly good Python code but no R code at all!

~~~
"""
download the file https://raw.githubusercontent.com/unmrds/cc-R-RStudio/master/cc-R-Names/data/2010 and save
it as '2010.csv' in the current working directory
"""

library
~~~

Copy and paste the response into your Python environment. Try to run it - does it work?

Note that this notebook includes the verbatim responses from ChatGPT used to develop
this tutorial. These responses have been tested andexecuted beforehand. Your own 
reponses from ChatGPT for the same prompt may be different. Always test code 
and expect to troubleshoot.

```{r download data}
# Load necessary library
library(utils)

# URL of the file
url <- "https://raw.githubusercontent.com/unmrds/cc-R-RStudio/master/cc-R-Names/data/2010"

# File name to save
file_name <- "2010.csv"

# Download the file
download.file(url, destfile = file_name, mode = "wb")

# Read the CSV file into a data frame
data <- read.csv(file_name)

# Now 'data' contains the contents of the CSV file
```

#### Explain code

Code responses may or may not come back with comments. Depending on our level of experience with R and different packages, we may or may not be able to understand what the code is doing. Since understanding is necessary for documenting and troubleshooting, it can be useful to ask ChatGPT to explain code. Below is the code I got as a response to the first prompt, which we can use in a new prompt to request an explanation.

~~~
# Explain

# Load necessary library
library(utils)

# URL of the file
url <- "https://raw.githubusercontent.com/unmrds/cc-R-RStudio/master/cc-R-Names/data/2010"

# File name to save
file_name <- "2010.csv"

# Download the file
download.file(url, destfile = file_name, mode = "wb")

# Read the CSV file into a data frame
data <- read.csv(file_name)

# Now 'data' contains the contents of the CSV file
~~~

Does the explanation make sense? Is it complete? 
If your response was different, ask ChatGPT to explain it now.

### Read the data

The data have been saved to our computer, but are not yet available to us in a format that we can analyze. We want to use the readr library to read the data into a dataframe. Do we need to be specific about which library to use? Let's see!

Also, since we've been getting R code so far, let's see what happens if we don't use a leading term like ```library()```.

~~~
"""
Read the file 2010.csv into a table and print the first five rows.
"""
~~~

The response uses the base R ```read.csv()``` function instead of 
the readr function, ```read_csv()```, but the result
is the same for our purposes. We will leave it as-is, but note that we may
need to specify packages or include a reference to the tidyverse in our prompts.

```{r read file}
# Read the CSV file into a data frame
data <- read.csv("2010.csv")

# Print the first five rows of the data frame
print(head(data, 5))

```













